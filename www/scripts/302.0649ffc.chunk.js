(self.webpackChunkasf_ui=self.webpackChunkasf_ui||[]).push([[302],{3827:(t,e,s)=>{"use strict";s.d(e,{$:()=>n,d:()=>l});const i=/"s_(\w+)":\s*"(\d+)"/g;function o(t,e,s,o){const n=document.createElement("a"),l=e?(a=t,JSON.stringify(a,null,2).replace(i,'"$1":$2')):t.join("\n");var a;n.setAttribute("href",`data:text/plain;charset=utf-8,${encodeURIComponent(l)}`),n.setAttribute("download",`${s}.${o}`),n.style.display="none",document.body.appendChild(n),n.click(),document.body.removeChild(n)}function n(t,e){o(t,!0,e,"json")}function l(t){o(t,!1,"log","txt")}},3702:(t,e,s)=>{var i=s(8081),o=s(3645)(i);o.push([t.id,".terminal-container{height:100%;display:flex;flex-direction:column}",""]),t.exports=o},9031:(t,e,s)=>{var i=s(8081),o=s(3645)(i);o.push([t.id,".log{display:grid;grid-template-rows:1fr}.log>div{min-height:0}",""]),t.exports=o},302:(t,e,s)=>{"use strict";s.r(e),s.d(e,{default:()=>g});var i=function(){var t=this._self._c;return t("main",{staticClass:"main-container main-container--fullheight log"},[t("div",{staticClass:"container"},[t("AsfLog")],1)])};i._withStripped=!0;var o=function(){var t=this,e=t._self._c;return e("div",{staticClass:"terminal-container"},[e("div",{staticClass:"form-item"},[e("div",{staticClass:"form-item__buttons"},[e("button",{staticClass:"button button--link",attrs:{disabled:t.fullLogLoaded},on:{click:t.onLoadPrevious}},[t.loading?e("FontAwesomeIcon",{attrs:{icon:"spinner",spin:""}}):e("span",[t._v(t._s(t.loadLogText))])],1),t._v(" "),e("button",{staticClass:"button button--link pull-right",on:{click:t.onDownload}},[t.downloading?e("FontAwesomeIcon",{attrs:{icon:"spinner",spin:""}}):e("span",[t._v(t._s(t.$t("log-download")))])],1)])]),t._v(" "),e("div",{ref:"terminal",staticClass:"terminal"},t._l(t.log,(function(s){let{type:i,message:o,index:n}=s;return e("div",{key:n,staticClass:"terminal-message terminal-message--truncated"},[e("span",{staticClass:"terminal-message__content"},[o.time&&t.selectedLayout.includes("time")?e("span",{staticClass:"terminal-message__time"},[t._v("["+t._s(t.handleTime(o.time))+"]")]):t._e(),t._v(" "),o.process&&t.selectedLayout.includes("process")?e("span",{staticClass:"terminal-message__process"},[t._v(t._s(o.process))]):t._e(),t._v(" "),o.level&&t.selectedLayout.includes("level")?e("span",{staticClass:"terminal-message__level",class:`terminal-message__level--${o.level.toLowerCase()}`},[t._v(t._s(o.level))]):t._e(),t._v(" "),o.logger&&t.selectedLayout.includes("logger")?e("span",{staticClass:"terminal-message__logger"},[t._v(t._s(o.logger))]):t._e(),t._v(" "),e("span",[t._v(">")]),t._v(" "),o.text?e("span",{staticClass:"terminal-message__text"},[t._v(t._s(o.text))]):t._e()])])})),0)])};o._withStripped=!0;var n=s(629),l=s(3827);const a=["time","process","level","logger"],r={name:"AsfLog",data:()=>({log:[],loading:!1,downloading:!1,inizialized:!1,lastAt:0,totalLines:0}),computed:{...(0,n.Se)({password:"auth/password",count:"settings/previousAmount",logInformation:"settings/logInformation",logTimestamp:"settings/logTimestamp"}),fullLogLoaded(){return this.lastAt<=0&&this.inizialized},loadLogText(){return this.fullLogLoaded?this.$t("log-previous-done"):this.$t("log-previous",{amount:this.count})},selectedLayout(){return Array.from(this.logInformation.toString(2)).reverse().reduce(((t,e,s)=>("1"===e&&t.push(a[s]),t)),[])}},watch:{log(){this.$refs.terminal.scrollTop<this.$refs.terminal.scrollHeight-this.$refs.terminal.clientHeight-20||this.$nextTick((()=>{this.$refs.terminal.scrollTop=Math.max(0,this.$refs.terminal.scrollHeight-this.$refs.terminal.clientHeight)}))}},created(){const t=`${window.__BASE_URL__.replace(/^http/,"ws")}api/nlog${this.password?`?password=${encodeURIComponent(this.password)}`:""}`;this.ws=new WebSocket(t),this.ws.onopen=this.onOpen.bind(this),this.ws.onmessage=this.onMessage.bind(this),this.ws.onclose=this.onClose.bind(this)},beforeDestroy(){this.ws.close()},methods:{onOpen(t){},onMessage(t){const e=JSON.parse(t.data).Result;this.log.push({type:"in",message:this.parseMessage(e)})},parseMessage(t){const[e,s,i,o,...n]=t.split("|");return s?{time:new Date(e.replace(/-/g,"/")),process:s,level:i,logger:o,text:n.join("|")}:{time:null,process:null,level:null,logger:null,text:t}},onClose(t){1006===t.code?console.error("Websocket error! Error code: 1006"):1e3!==t.code&&this.$error(`Websocket error! Error code: ${t.code}`)},async onDownload(){if(!this.downloading){this.downloading=!0;try{const t=2147483647,e=await this.$http.get(`nlog/file?count=${t}`);(0,l.d)(e.Content)}catch(t){this.$error(t.message)}finally{this.downloading=!1}}},async onLoadPrevious(){if(!this.loading){this.loading=!0;try{if(!this.inizialized){const t=await this.$http.get(`nlog/file?count=${this.count}`);this.totalLines=t.TotalLines,this.lastAt=this.totalLines-this.log.length,this.inizialized=!0}const t=await this.$http.get(`nlog/file?count=${this.count}&lastAt=${this.lastAt}`);this.lastAt>0&&(this.lastAt-=this.count);const e=t.Content.map((t=>({type:"in",message:this.parseMessage(t)})));this.log=e.concat(this.log)}catch(t){this.$error(t.message)}finally{this.loading=!1}}},handleTime(t){const e={year:"2-digit",month:"2-digit",day:"2-digit",hour:"2-digit",minute:"2-digit",second:"2-digit"},s={hour:"2-digit",minute:"2-digit",second:"2-digit"};return"timeOnlyEu"===this.logTimestamp?t.toLocaleTimeString("de-DE",s):"timeOnlyLocale"===this.logTimestamp?t.toLocaleTimeString():"timeOnlyUs"===this.logTimestamp?t.toLocaleTimeString("en-US",s):"timeDateEu"===this.logTimestamp?t.toLocaleString("de-DE",e):"timeDateLocale"===this.logTimestamp?t.toLocaleString():"timeDateUs"===this.logTimestamp?t.toLocaleString("en-US",e):void 0}}};s(6678);var c=s(1900);const d={name:"Log",metaInfo(){return{title:this.$t("log")}},components:{AsfLog:(0,c.Z)(r,o,[],!1,null,null,null).exports}};s(6662);const g=(0,c.Z)(d,i,[],!1,null,null,null).exports},6678:(t,e,s)=>{var i=s(3702);i.__esModule&&(i=i.default),"string"==typeof i&&(i=[[t.id,i,""]]),i.locals&&(t.exports=i.locals),(0,s(5346).Z)("443f705a",i,!1,{})},6662:(t,e,s)=>{var i=s(9031);i.__esModule&&(i=i.default),"string"==typeof i&&(i=[[t.id,i,""]]),i.locals&&(t.exports=i.locals),(0,s(5346).Z)("83dbebf4",i,!1,{})}}]);