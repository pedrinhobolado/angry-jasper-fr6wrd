(self.webpackChunkasf_ui=self.webpackChunkasf_ui||[]).push([[9098],{2768:(t,s,e)=>{var a=e(8081),i=e(3645)(a);i.push([t.id,".status-text{text-align:center}.status-text a{color:var(--color-theme)}.button--helper{max-width:2em}",""]),t.exports=i},9098:(t,s,e)=>{"use strict";e.r(s),e.d(s,{default:()=>h});var a=function(){var t=this,s=t._self._c;return s("main",{staticClass:"main-container main-container--center"},[s("div",{staticClass:"container container--small"},[s("h2",{staticClass:"title"},[t._v(t._s(t.$t("setup")))]),t._v(" "),"AUTHENTICATED"===t.status?s("div",[t.$route.params.restart?s("p",{staticClass:"status-text"},[t._v(t._s(t.$t("setup-restart")))]):t.$route.params.update?s("p",{staticClass:"status-text"},[t._v(t._s(t.$t("setup-update")))]):s("p",{staticClass:"status-text"},[t._v(t._s(t.$t("setup-authenticated")))])]):t._e(),t._v(" "),t.statusText?s("p",{staticClass:"status-text",domProps:{innerHTML:t._s(t.statusText)}}):t._e(),t._v(" "),"UNAUTHORIZED"===t.status?s("div",{staticClass:"form-item"},[s("div",{staticClass:"form-item__code"},[s("div",[s("label",{staticClass:"form-item__label",attrs:{for:"password"}},[t._v(t._s(t.$t("password")))]),t._v(" "),s("input",{directives:[{name:"model",rawName:"v-model",value:t.password,expression:"password"}],staticClass:"form-item__input",attrs:{id:"password",type:"password"},domProps:{value:t.password},on:{keydown:function(s){return!s.type.indexOf("key")&&t._k(s.keyCode,"enter",13,s.key,"Enter")?null:t.updatePassword.apply(null,arguments)},input:function(s){s.target.composing||(t.password=s.target.value)}}})]),t._v(" "),s("div",{staticClass:"form-item__buttons form-item__buttons--column"},[s("button",{directives:[{name:"tooltip",rawName:"v-tooltip",value:t.$t("input-switch-visibility"),expression:"$t('input-switch-visibility')"}],staticClass:"button button--helper",on:{click:t.switchInputType}},[t.inputHidden?s("FontAwesomeIcon",{attrs:{icon:"eye",size:"lg"}}):s("FontAwesomeIcon",{attrs:{icon:"eye-slash",size:"lg"}})],1)])])]):t._e(),t._v(" "),"AUTHENTICATED"!==t.status?s("div",{staticClass:"form-item"},[s("div",{staticClass:"form-item__buttons form-item__buttons--center"},[s("button",{staticClass:"button button--confirm",on:{click:t.onButtonClick}},[t.processing?s("FontAwesomeIcon",{attrs:{icon:"spinner",spin:""}}):s("span",[t._v(t._s(t.buttonText))])],1)])]):t._e()])])};a._withStripped=!0;var i=e(629),r=e(5038),n=e(795),o=e(144),u=e(6169),c=e(147);const d={name:"Setup",metaInfo(){return{title:this.$t("setup")}},data(){return{password:this.$store.getters["auth/password"],processing:!1,countdown:5,timer:null,inputHidden:!0}},computed:{...(0,i.Se)({status:"auth/status"}),buttonText(){switch(this.status){case r.Q.UNAUTHORIZED:case r.Q.AUTHENTICATED:return this.$t("continue");default:return this.$t("refresh")}},statusText(){switch(this.status){case r.Q.UNAUTHORIZED:return this.$t("setup-description");case r.Q.NOT_CONNECTED:return this.$t("setup-not-connected");case r.Q.GATEWAY_TIMEOUT:return this.$t("setup-gateway-timeout",{n:this.countdown});case r.Q.NETWORK_ERROR:return this.$t("setup-network-error",{n:this.countdown});case r.Q.NO_IPC_PASSWORD:return this.$t("setup-no-ipc-password");case r.Q.RATE_LIMITED:return this.$t("setup-rate-limited");default:return null}}},watch:{status(){this.cancelAutoUpdate(),this.checkStatus()},countdown:{immediate:!0,handler(t){t>0&&setTimeout((()=>this.countdown--),1e3),0===t&&(this.countdown=5)}},$route:{immediate:!0,async handler(){this.$route.params.restart?await this.handleWaiting("restart"):this.$route.params.update?await this.handleWaiting("update"):this.checkStatus()}}},beforeDestroy(){this.cancelAutoUpdate()},mounted(){this.onButtonClick()},methods:{switchInputType(){this.inputHidden=!this.inputHidden;const t=document.getElementById("password");"password"===t.getAttribute("type")?t.setAttribute("type","text"):t.setAttribute("type","password")},async handleWaiting(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"restart";this.processing=!0,await async function(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:12e4;const s=Date.now();for(;s>Date.now()-t;){if(await c.Z.dispatch("asf/update"),Date.now()-c.Z.getters["asf/startTime"].getTime()<1e4)return;await(0,u.Z)(1e3)}throw new Error(o.default.i18n.translate("restart-failure"))}(),"restart"===t?this.$success(this.$t("restart-complete")):"update"===t&&this.$success(this.$t("update-complete")),this.processing=!1,this.checkStatus()},async onButtonClick(){if(!this.processing)switch(this.status){case r.Q.UNAUTHORIZED:this.updatePassword();break;case r.Q.AUTHENTICATED:this.redirect();break;default:this.refreshStatus()}},async updatePassword(){this.processing=!0,n.Od("cache:authentication-required");try{await this.$store.dispatch("auth/setPassword",this.password),await this.$store.dispatch("auth/validate")?this.redirect():(await this.resetPassword(),this.$error(this.$t("password-invalid")))}catch(t){this.$error(t.message)}finally{this.processing=!1}},async refreshStatus(){this.processing=!0;try{await this.$store.dispatch("auth/updateStatus")}catch(t){this.$error(t.message)}finally{this.processing=!1}},redirect(){this.$router.replace({name:"home"},(()=>{}),(()=>{}))},cancelAutoUpdate(){clearInterval(this.timer)},async checkStatus(){switch(this.status){case r.Q.AUTHENTICATED:this.redirect();break;case r.Q.RATE_LIMITED:this.cancelAutoUpdate();break;case r.Q.UNAUTHORIZED:case r.Q.NO_IPC_PASSWORD:this.cancelAutoUpdate(),await this.resetPassword();break;default:this.timer=setInterval(this.refreshStatus,1e3*this.countdown)}},async resetPassword(){this.password=null,await this.$store.dispatch("auth/setPassword",this.password)}}};e(4498);const h=(0,e(1900).Z)(d,a,[],!1,null,null,null).exports},4498:(t,s,e)=>{var a=e(2768);a.__esModule&&(a=a.default),"string"==typeof a&&(a=[[t.id,a,""]]),a.locals&&(t.exports=a.locals),(0,e(5346).Z)("462dc910",a,!1,{})}}]);